\section{Samples} \label{sec:samples}

In order to perform the analysis, datasets collected with the CMS detector from 2016-18 are used, as well as a slew of simulation samples in order to optimize the analysis strategy for the desired HH$\rightarrow$WW$\gamma\gamma$ physics signature, and perform statistical inferences by fitting simulation to data in order to extract the analysis' final results. 

In this Section, the CMS data samples used will be described in Section \ref{sec:data_samples}, the simulated signal samples will be described in Section \ref{sec:signal_simulation}, the simulated background samples will be described in Section \ref{sec:background_simulation}, and the corresponding simulation hadronization and detector response will be described in Section \ref{sec:HadronizationAndDetectorResponse}. 

\subsection{Data} \label{sec:data_samples}

The analyzed data correspond to a total integrated luminosity of 138 \unit{fb$^{-1}$} and were collected during Run 2 at the LHC from 2016 to 2018. In order to select events which may come from the HH$\rightarrow$WW$\gamma\gamma$ process, events with highly energetic photons are selected in order to tag the H$\rightarrow\gamma\gamma$ leg of the HH process.

Events are selected using double-photon triggers with thresholds on the leading (subleading) photon transverse momentum (\pt) of $p_T^{\gamma} > 30 \ (18)$ GeV
for the data collected during 2016
and $p_T^{\gamma} > 30 \ (22)$ GeV for 2017 and 2018.
In addition, loose calorimetric identification requirements \cite{Sirunyan:2018ouh}, based
on the shape of the electromagnetic shower, the isolation of the photon candidate, and the ratio
between the hadronic and electromagnetic energy deposit of the shower, are imposed on the
photon candidates at the trigger level.

The HLT paths applied to events from these datasets are:

\begin{center}
        {\tt HLT\_Diphoton30\_18\_R9Id\_OR\_IsoCaloId\-\_AND\_HE\_R9Id\_Mass90} (2016 data) \\ 
        {\tt HLT\_Diphoton30\_22\_R9Id\_OR\_IsoCaloId\-\_AND\_HE\_R9Id\_Mass90} (2017 and 2018 data) \\
        {\tt HLT\_Diphoton30\_22\_R9Id\_OR\_IsoCaloId\-\_AND\_HE\_R9Id\_Mass95} (2017 and 2018 data) \\ 
\end{center}

Datasets expected to contain events with two photons are used in order to obtain events containing the $H\rightarrow\gamma\gamma$ process,
and further selections are applied to identify events that also contain the $H\rightarrow WW$ process. 

\subsection{Signal simulation} \label{sec:signal_simulation}

% SIGNAL
Di-Higgs signal Monte-Carlo (simulation) samples in the gluon-gluon fusion production mode are generated using POWHEG v2 \cite{Nason:2004rx, Frixione:2007vw, Alioli:2010xd, Heinrich:2019bkc}
at NLO in QCD including the full top quark mass dependence
for four different sets of $(\kappa_{\lambda}, \kappa_{t})$ parameter values: $(1, 1)$, $(2.45, 1)$, $(5, 1)$ and $(0, 1)$, where these parameters are defined in section \ref{EFT_parameters_description}. 
In addition, 12 EFT benchmark samples in a five-dimensional EFT model space are generated at LO \cite{Carvalho:2015ttv} using MadGraph, where the EFT coupling parameter values are defined in the rows labelled 
1-12 of Tab. \ref{tab:eft_bench}.   

A combination of the four NLO signal simulation samples, in which the EFT parameters are varied as $(\kappa_{\lambda}, \kappa_{t}) = $ $(1, 1)$, $(2.45, 1)$, $(5, 1)$ and $(0, 1)$, is reweighted using an analytic formula derived in \cite{Carvalho:2016rys,Buchalla:2018yce}. The analytic formula is shown in Eq.\ref{eq:reweight_eq}. 
The signal hypotheses to which this combination of NLO samples is reweighted to are defined as the 20 benchmark scenarios (1-12 \cite{Carvalho:2015ttv}, 8a \cite{Buchalla:2018yce}, 1b-7b \cite{Capozi:2019xsi}), shown in Tab. \ref{tab:eft_bench}. 

A possible way to improve this analysis in the future would be to include the VBF production mode of HH in the signal definition, and include a dedicated VBF tagging category in order to improve the overall analysis sensitivity. While this may not have a significant impact on the final result due to its low production cross section, it may be able to improve the sensitivity of the analysis on order of $\approx$ 5\%. 

\subsection{Background simulation} \label{sec:background_simulation}

% add feynman diagrams?

% BACKGROUNDS
The analysis is affected by backgrounds from single Higgs boson production and by non-resonant backgrounds which manifest as a continuum in the $m_{\gamma\gamma}$ spectrum.
Monte Carlo event generators were used for the simulation of the background from SM single Higgs boson production, including
gluon gluon fusion ($ggH$), associated production with a $Z$ or $W$ boson ($VH$), associated production with a top quark pair ($ttH$)
simulated at NLO in QCD precision using MadGraph5\_aMCatNLO \cite{Alwall:2014hca, Artoisenet:2012st} with the FxFx merging scheme \cite{Frederix:2012ps},
and vector-boson fusion (VBF $H$) using POWHEG v2 \cite{Nason:2004rx, Frixione:2007vw}.

The continuum background contribution from SM processes with multiple photons is estimated using data-driven methods described in Sec. \ref{sec:AnalyticFitting_Background}. In the SL and 
FH final states, MVA methods are employed which use background MC for training.
The continuum background MC includes $\gamma+$jets modeled with the PYTHIA 8 \cite{Sjostrand:2014zea} generator, $\gamma\gamma+$jets modeled with the SHERPA v.2.2.1 generator \cite{Bothmann:2019yzt}, $0,1,2\gamma+W+$jets, $t\bar{t}$, and $t\bar{t}W$ modeled using MadGraph5\_aMCatNLO \cite{Alwall:2014hca,Artoisenet:2012st,Frederix:2012ps}.

% \subsection{MC}

% The analysis is affected by backgrounds from single-Higgs-boson production and by non-resonant backgrounds with continuum $m_{\gamma\gamma}$ spectra.
% The continuum background contribution from SM processes with multiple photons and jets is estimated using data-driven methods described in Sec. \ref{sec:AnalyticFitting_Background}. 
% Monte Carlo event generators were used for the simulation of the background from SM single Higgs boson production, including 
% gluonâ€“gluon fusion ($ggH$), associated production with a Z or W boson ($VH$), associated
% production with a top quark pair ($ttH$) and vector-boson fusion (VBF H) (Table \ref{tab:SMH_MCMiniAODSamples}). 

% In addition, the DNN based analyses in the Semi-Leptonic channel uses the 2017 background MC MiniAOD samples in Table \ref{tab:MCMiniAODSamples} and Table \ref{tab:SMH_MCMiniAODSamples} for training.

% \subsection{Signal MC}
% In the Effective Field Theory (EFT) description, gluon-gluon fusion Higgs boson pair production can be generally described by five parameters ($\kappa_{\lambda}$, $\kappa_{t}$, $c_{2}$, $c_{g}$, $c_{2g}$) controlling the tree-level interactions 
% of the Higgs boson as described in Ref \ref{section:introduction}, and shown in Figure \ref{fig:ggHH_production}.
% For the experimental exploration of the five-dimensional EFT model space, 12 benchmarks (Table \ref{tab:eft_bench}) are considered following \cite{Carvalho:2016rys, Carvalho:2015ttv}.
% This manageably small set of benchmark points can be used to represent the volume of the unexplored parameter space.

% The LO EFT MC samples generated using the full CMS detector simulation are listed in Table \ref{tab:eft_samples}. 
% The generation is performed with MadGraph5\_aMCatNLO \cite{Alwall:2014hca}.
% Unfortunatly, when the simulation was launched within the CMS system, the version of the EFT benchmarks was preliminary, meaning the simulated 
% samples used an outdated version of the recommended benchmarks. 
% In addition, for 2017 and 2018 MC production, a mistake was made during the production of the SM sample, where the value of the $c_g$ coupling was set to 1.0.
% % Is this also true for all of the other benchmarks? I thought this was the case but perhaps I am remembering incorrectly.

% In order to use the updated clustering scheme with the 12 BSM benchmarks and SM point, a reweighting is implemented to obtain the benchmarks of interest.
% The reweighting procedure used is described in Section \ref{sec:reweighting}.

% %% I think we should add Feynman Diagrams to show the different EFT couplings. Maybe the SM diagrams can be added to the introduction.  
% \begin{table}[h]
%   \begin{center}
%     \begin{tabular}{r|ccccc}
%       Benchmark & $\kappa_{\lambda}$ & $\kappa_{t}$ & $c_{2}$	& $c_{g}$ & $c_{2g}$ \\ \hline \\
%       1 &	7.5	 & 1.0	 &	-1.0	& 0.0	& 0.0 \\
%       2 &	1.0	 & 1.0	 &	0.5		& -0.8	& 0.6 \\
%       3 &	1.0	 & 1.0	 &	-1.5	& 0.0	& -0.8 \\
%       4 &	-3.5 & 1.5  &	-3.0	& 0.0	& 0.0 \\
%       5 &	1.0	 & 1.0	 &	0.0		& 0.8	& -1 \\
%       6 &	2.4	 & 1.0	 &	0.0		& 0.2	& -0.2 \\
%       7 &	5.0	 & 1.0	 &	0.0		& 0.2	& -0.2 \\
%       8 &	15.0 & 1.0	 &	0.0		& -1	& 1 \\
%       9 &	1.0	 & 1.0	 &	1.0		& -0.6	& 0.6 \\
%       10 &	10.0 & 1.5   &	-1.0	& 0.0	& 0.0 \\
%       11 &	2.4	 & 1.0	 &	0.0		& 1		& -1 \\
%       12 &	15.0 & 1.0	 &	1.0		& 0.0	& 0.0 \\ \hline
%       SM &	1.0 & 1.0	 &	0.0		& 0.0	& 0.0 \\
%       Box &	0.0 & 1.0	 &	0.0		& 0.0	& 0.0 \\
%     \end{tabular}
%   \end{center}
%   \caption{Parameter values of the twelve benchmarks and the Standard Model and Box points. \label{tab:eft_bench}}
% \end{table}

% In addition, NLO in QCD MC samples are generated using Powheg \cite{Nason:2004rx, Frixione:2007vw, Alioli:2010xd, Heinrich:2019bkc} for four different sets of $(\kappa_{\lambda}, \kappa_{t})$ parameters: $(1, 1)$, $(2.45, 1)$, $(5, 1)$ and $(0, 1)$. The NLO samples are listed in Table \ref{tab:eft_nlo_samples}. 

% The PYTHIA 8 \cite{Sjostrand:2014zea} package is used for parton showering, hadronization, and the underlying event simulation of LO and NLO signal samples, 
% with parameters set by the CUETP8M1 tune \cite{Khachatryan:2015pea} (2016 data taking period) and the CP5 tune \cite{Sirunyan:2019dfx} (2017 and 2018 data taking periods). The signal samples are generated for the three possible final states of $WW$ system: Semi-Leptonic ($WW\rightarrow qql\nu$), Fully-Leptonic ($WW\rightarrow l\nu l\nu$) and Fully-Hadronic ($WW\rightarrow qqqq$) where $l = e, \mu$ or $\tau$.
% Signal samples are also generated for the Fully-Hadronic $ZZ$ final state: $ZZ \rightarrow qqqq$.  

\subsection{Hadronization and detector response} \label{sec:HadronizationAndDetectorResponse}

% HADRONISATON & DETECTOR RESPONSE
The PYTHIA 8 \cite{Sjostrand:2014zea} package is used for parton showering, hadronization, and the underlying event simulation of all signal and background samples (with the exception of $1,2\gamma+$jets MC from SHERPA v.2.2.1),
with parameters set by the CUETP8M1 tune \cite{Khachatryan:2015pea} (2016 data taking period) and the CP5 tune \cite{Sirunyan:2019dfx} (2017 and 2018 data taking periods). Parton distribution functions (PDFs) are taken from the NNPDF3.0 set \cite{Ball:2014uwa}.
The response of the CMS detector is modeled using the Geant4 package \cite{AGOSTINELLI2003250}.
The simulated events include additional $pp$ interactions within the same or nearby bunch crossings (pileup), generated using Pythia and overlaid on the MC events using event weights so that the distribution of the number of collisions matches the data.
